<!DOCTYPE html>
<html lang="ko-kr"
  dir="ltr">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">








    






<link rel="icon" type="image/ico" href="https://choieastsea.github.io//favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://choieastsea.github.io//favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://choieastsea.github.io//favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="https://choieastsea.github.io//android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://choieastsea.github.io//apple-touch-icon.png">

<meta name="description" content=""/>



<title>
    
    ASGI - uvicorn ì½”ë“œë¡œ ì•Œì•„ë³´ëŠ” ASGI server | choieastsea.github.io
    
</title>

<link rel="canonical" href="https://choieastsea.github.io/posts/15/"/>

<meta property="og:url" content="https://choieastsea.github.io/posts/15/">
  <meta property="og:site_name" content="choieastsea.github.io">
  <meta property="og:title" content="ASGI - uvicorn ì½”ë“œë¡œ ì•Œì•„ë³´ëŠ” ASGI server">
  <meta property="og:description" content="uvicorn / startup / protocol">
  <meta property="og:locale" content="ko_kr">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-01T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-01T00:00:00+00:00">
    <meta property="article:tag" content="Web Server">
    <meta property="article:tag" content="Server">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Asgi">
    <meta property="article:tag" content="Fastapi">
    <meta property="article:tag" content="Uvicorn">












<link rel="stylesheet" href="/assets/combined.min.0f4f5c64ee7100cff28e7c7366d922b5499829f72c91a53b9b17f236d85ad7e7.css" media="all">















    




</head>







<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="https://choieastsea.github.io/">choieastsea.github.io</a>
    </h1>

    <div class="flex">
        

        
        
      
        <p class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/about" >
                /about
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/posts" >
                /posts
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/tags" >
                /tags
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      




<div class="breadcrumbs"><a href="/">Home</a><span class="breadcrumbs-separator">/</span><a href="/posts/">Posts</a><span class="breadcrumbs-separator">/</span>
        <a href="/posts/15/">ASGI - uvicorn ì½”ë“œë¡œ ì•Œì•„ë³´ëŠ” ASGI server</a></div>


<div >

  <div class="single-intro-container">

    

    <h1 class="single-title">ASGI - uvicorn ì½”ë“œë¡œ ì•Œì•„ë³´ëŠ” ASGI server</h1>
    
    <p class="single-summary">uvicorn / startup / protocol</p>
    

    

    <p class="single-readtime">
      
      
      
      <time datetime="2025-10-01T00:00:00&#43;00:00">October 1, 2025</time>
      

      
      &nbsp; Â· &nbsp;
      4 min read
      
    </p>

  </div>

  

  
  

  <div class="single-tags">
    
    <span>
      <a href="https://choieastsea.github.io/tags/web-server/">#Web Server</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/server/">#Server</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/python/">#Python</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/asgi/">#Asgi</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/fastapi/">#Fastapi</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/uvicorn/">#Uvicorn</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/debugging/">#Debugging</a>
    </span>
    
    
  </div>

  
  

  

  
  <aside class="toc">
    <p><strong>Table of contents</strong></p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#uvicorn">uvicorn</a></li>
    <li><a href="#í™˜ê²½-ì„¤ì •">í™˜ê²½ ì„¤ì •</a>
      <ul>
        <li><a href="#vscode-ë””ë²„ê¹…-í™˜ê²½-êµ¬ì„±">vscode ë””ë²„ê¹… í™˜ê²½ êµ¬ì„±</a></li>
      </ul>
    </li>
    <li><a href="#startup">startup</a></li>
    <li><a href="#protocol">Protocol</a>
      <ul>
        <li><a href="#cycle-uvicorn">Cycle (uvicorn)</a></li>
      </ul>
    </li>
    <li><a href="#asgi-application-ì‹¤í–‰">ASGI Application ì‹¤í–‰</a></li>
    <li><a href="#ì •ë¦¬">ì •ë¦¬</a></li>
  </ul>
</nav>
  </aside>
  

  

  <div class="single-content">
    <p>ì €ë²ˆì— ì´ì–´ ASGI serverì— ëŒ€í•´ ì•Œì•„ë³´ê³ , ê°„ë‹¨í•œ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ <code>uvicorn</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ ì„œë¹™í•˜ê³  ë””ë²„ê¹…í•´ë³´ë©° ASGI serverì—ì„œ í•˜ëŠ” ì¼ë“¤ì„ ì•Œì•„ë³´ì.</p>
<h2 class="heading" id="uvicorn">
  uvicorn
  <a class="anchor" href="#uvicorn">#</a>
</h2>
<p>uvicornì€ ëŒ€í‘œì ì¸ ASGI serverì˜ êµ¬í˜„ì²´ì´ë‹¤. <a href="https://github.com/Kludex/uvicorn">github</a></p>
<p><code>fastapi</code>ì™€ ê°™ì€ ASGI applicationì„ ì„œë¹™í•  ë•Œ í•„ìš”í•œ ì¡´ì¬ì´ë©°, ìƒë‹¨ì— WSGI serverì¸ <code>gunicorn</code>ì„ ë‘ì–´ ìŠ¤ì¼€ì¼ ì•„ì›ƒì„ í•˜ê¸°ë„ í•œë‹¤. (ì•„ë‹ˆë©´ nginxì™€ ê°™ì€ web serverì— ì—°ê²°ëœë‹¤)</p>
<h2 class="heading" id="í™˜ê²½-ì„¤ì •">
  í™˜ê²½ ì„¤ì •
  <a class="anchor" href="#%ed%99%98%ea%b2%bd-%ec%84%a4%ec%a0%95">#</a>
</h2>
<p>ìš°ì„  ê°„ë‹¨í•œ ê°œë°œí™˜ê²½ì„ ì„¤ì •í•œë‹¤. <code>uv</code>ë¥¼ ì‚¬ìš©í–ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>â¯ uv init asgi
</span></span><span style="display:flex;"><span>â¯ <span style="font-weight:bold;font-style:italic">cd</span> asgi
</span></span><span style="display:flex;"><span>â¯ uv add uvicorn
</span></span></code></pre></div><p><code>main.py</code>ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•œë‹¤. ê°„ë‹¨í•œ HTTP ìš”ì²­ì„ pathì™€ í•¨ê»˜ ë°›ì•„ hello worldë¥¼ ì¶œë ¥í•´ì£¼ëŠ” <strong>ASGI application</strong>ì´ë‹¤. application specì€ <a href="https://choieastsea.github.io/posts/14/">ì´ì „ ê¸€ì„ ì°¸ê³ </a>í•œë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">import</span> <span style="color:#666;font-weight:bold;font-style:italic">asyncio</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">async</span> <span style="font-weight:bold;text-decoration:underline">def</span> <span style="color:#666;font-weight:bold;font-style:italic">app</span>(scope, receive, send):
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">if</span> scope.get(<span style="color:#666;font-style:italic">&#34;type&#34;</span>) != <span style="color:#666;font-style:italic">&#34;http&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">raise</span> NotImplementedError
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    path = scope.get(<span style="color:#666;font-style:italic">&#34;path&#34;</span>, <span style="color:#666;font-style:italic">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span>    name = path.split(<span style="color:#666;font-style:italic">&#34;/&#34;</span>)[1] <span style="font-weight:bold">or</span> <span style="color:#666;font-style:italic">&#34;world&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">await</span> asyncio.sleep(1)
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">await</span> send(
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#666;font-style:italic">&#34;type&#34;</span>: <span style="color:#666;font-style:italic">&#34;http.response.start&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#666;font-style:italic">&#34;status&#34;</span>: 200,
</span></span><span style="display:flex;"><span>            <span style="color:#666;font-style:italic">&#34;headers&#34;</span>: [(<span style="color:#666;font-style:italic">b</span><span style="color:#666;font-style:italic">&#34;content-type&#34;</span>, <span style="color:#666;font-style:italic">b</span><span style="color:#666;font-style:italic">&#34;text/plain; charset=utf-8&#34;</span>)],
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">await</span> send(
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#666;font-style:italic">&#34;type&#34;</span>: <span style="color:#666;font-style:italic">&#34;http.response.body&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#666;font-style:italic">&#34;body&#34;</span>: <span style="color:#666;font-style:italic">f</span><span style="color:#666;font-style:italic">&#34;hello </span><span style="color:#666;font-style:italic">{</span>name<span style="color:#666;font-style:italic">}</span><span style="color:#666;font-style:italic">\n</span><span style="color:#666;font-style:italic">&#34;</span>.encode(),
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">if</span> __name__ == <span style="color:#666;font-style:italic">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">import</span> <span style="color:#666;font-weight:bold;font-style:italic">uvicorn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    uvicorn.run(<span style="color:#666;font-style:italic">&#34;main:app&#34;</span>, host=<span style="color:#666;font-style:italic">&#34;127.0.0.1&#34;</span>, port=8000)
</span></span></code></pre></div><p><code>scope</code>ì—ëŠ” connectionì— ëŒ€í•œ ì •ì ì¸ ë©”íƒ€ë°ì´í„°ê°€ ë“¤ì–´ìˆê³ , <code>send</code> íŒŒë¼ë¯¸í„°ëŠ” awaitable callableì´ ì£¼ì…ë˜ì–´ dictionaryë¡œ ASGI serverê°€ clientì—ê²Œ ì‘ë‹µí•˜ê¸°ë¥¼ ê¸°ëŒ€í•œë‹¤.</p>
<p>ìœ„ ì½”ë“œëŠ” scopeë¡œë¶€í„° path parameterë¥¼ ê°€ì ¸ì™€ &ldquo;hello {name}&ldquo;ì˜ ê¼´ë¡œ ì‘ë‹µí•˜ê³  ì¢…ë£Œí•˜ê¸°ë¥¼ ê¸°ëŒ€ëœë‹¤.</p>
<p>ì´ì œ ë””ë²„ê¹…ì„ í•´ë³´ì!</p>
<h3 class="heading" id="vscode-ë””ë²„ê¹…-í™˜ê²½-êµ¬ì„±">
  vscode ë””ë²„ê¹… í™˜ê²½ êµ¬ì„±
  <a class="anchor" href="#vscode-%eb%94%94%eb%b2%84%ea%b9%85-%ed%99%98%ea%b2%bd-%ea%b5%ac%ec%84%b1">#</a>
</h3>
<p><code>vscode</code>ì˜ <code>launch.json</code>ì„ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ê³  ë””ë²„ê¹…ì„ ìˆ˜í–‰í•˜ì˜€ë‹¤. ê°€ìƒí™˜ê²½ python ìœ„ì¹˜ì™€ justMyCodeë¥¼ falseë¡œ ë‘ì–´ ì„¤ì¹˜í•œ uvicorn ì½”ë“œê¹Œì§€ ë³´ë„ë¡ í•˜ì.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;version&#34;: <span style="color:#666;font-style:italic">&#34;0.2.0&#34;</span>,
</span></span><span style="display:flex;"><span>    &#34;configurations&#34;: [
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            &#34;name&#34;: <span style="color:#666;font-style:italic">&#34;debug ASGI&#34;</span>,
</span></span><span style="display:flex;"><span>            &#34;type&#34;: <span style="color:#666;font-style:italic">&#34;debugpy&#34;</span>,
</span></span><span style="display:flex;"><span>            &#34;request&#34;: <span style="color:#666;font-style:italic">&#34;launch&#34;</span>,
</span></span><span style="display:flex;"><span>            &#34;python&#34;: <span style="color:#666;font-style:italic">&#34;${command:python.interpreterPath}&#34;</span>,
</span></span><span style="display:flex;"><span>            &#34;program&#34;: <span style="color:#666;font-style:italic">&#34;main.py&#34;</span>,
</span></span><span style="display:flex;"><span>            &#34;console&#34;: <span style="color:#666;font-style:italic">&#34;integratedTerminal&#34;</span>,
</span></span><span style="display:flex;"><span>            &#34;justMyCode&#34;: <span style="font-weight:bold;text-decoration:underline">false</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ì£¼ìš” ì§€ì ì— ëŒ€í•´ ë¸Œë ˆì´í¬ í¬ì¸íŠ¸ë¥¼ ì°ê³ , ASGI ì„œë²„ê°€ ì–´ë–¤ ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ”ì§€ë¥¼ ìœ„ì£¼ë¡œ ì‚´í´ë³´ê³ ì í•œë‹¤. event loopì™€ ê·¸ ìŠ¤í™ì€ ê°„ë‹¨í•˜ê²Œë§Œ ì§šê³  ë„˜ì–´ê°„ë‹¤.</p>
<p>(ì´í•˜ì˜ ì½”ë“œë“¤ì€ ì¤‘ìš” ë¶€ë¶„ë§Œ ë‚¨ê¸°ê³ , ì¼ë¶€ëŠ” ìƒëµ &amp; ì£¼ì„ì„ ìˆ˜ì •í•˜ì˜€ìœ¼ë‹ˆ ì›ë³¸ì„ ë³´ê³  ì‹¶ìœ¼ë©´ í•´ë‹¹ ì½”ë“œë¥¼ ì§ì ‘ í™•ì¸í•˜ì)</p>
<h2 class="heading" id="startup">
  startup
  <a class="anchor" href="#startup">#</a>
</h2>
<p><code>uvicorn/server.py</code></p>
<p>ASGI serverê°€ ìµœì´ˆ ì‹¤í–‰ë  ë•Œ(_serve ë©”ì„œë“œ) startupì´ í˜¸ì¶œëœë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">class</span> <span style="color:#666;font-weight:bold;font-style:italic">Server</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">async</span> <span style="font-weight:bold;text-decoration:underline">def</span> <span style="color:#666;font-weight:bold;font-style:italic">startup</span>(<span style="font-weight:bold;font-style:italic">self</span>, sockets: <span style="font-weight:bold;font-style:italic">list</span>[socket.socket] | <span style="font-weight:bold;text-decoration:underline">None</span> = <span style="font-weight:bold;text-decoration:underline">None</span>) -&gt; <span style="font-weight:bold;text-decoration:underline">None</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">await</span> <span style="font-weight:bold;font-style:italic">self</span>.lifespan.startup()
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">def</span> <span style="color:#666;font-weight:bold;font-style:italic">create_protocol</span>(
</span></span><span style="display:flex;"><span>            _loop: asyncio.AbstractEventLoop | <span style="font-weight:bold;text-decoration:underline">None</span> = <span style="font-weight:bold;text-decoration:underline">None</span>,
</span></span><span style="display:flex;"><span>        ) -&gt; asyncio.Protocol:
</span></span><span style="display:flex;"><span>            ...
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">try</span>:
</span></span><span style="display:flex;"><span>            server = <span style="font-weight:bold;text-decoration:underline">await</span> loop.create_server(
</span></span><span style="display:flex;"><span>                create_protocol,
</span></span><span style="display:flex;"><span>                host=config.host,
</span></span><span style="display:flex;"><span>                port=config.port,
</span></span><span style="display:flex;"><span>                ssl=config.ssl,
</span></span><span style="display:flex;"><span>                backlog=config.backlog,
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">except</span> OSError <span style="font-weight:bold;text-decoration:underline">as</span> exc:
</span></span><span style="display:flex;"><span>            logger.error(exc)
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold;text-decoration:underline">await</span> <span style="font-weight:bold;font-style:italic">self</span>.lifespan.shutdown()
</span></span><span style="display:flex;"><span>            sys.exit(1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">assert</span> server.sockets <span style="font-weight:bold">is</span> <span style="font-weight:bold">not</span> <span style="font-weight:bold;text-decoration:underline">None</span>
</span></span><span style="display:flex;"><span>        listeners = server.sockets
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;font-style:italic">self</span>.servers = [server]
</span></span></code></pre></div><p><code>create_protocol</code> ë©”ì„œë“œëŠ” <strong>í˜„ì¬ ì´ë²¤íŠ¸ ë£¨í”„</strong>ë¥¼ ê°€ì ¸ì˜¤ê³ , ASGI ì„œë²„ ì‹¤í–‰ì‹œ ì„¤ì •í•œ ASGI application ì •ë³´ë¥¼ í†µí•´ <code>Protocol</code> ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.</p>
<p><a href="https://docs.python.org/ko/3.13/library/asyncio-protocol.html#protocols">Protocol</a>ì€ ì €ìˆ˜ì¤€ì˜ í†µì‹  ì±„ë„ì˜ ì¶”ìƒí™” ê°ì²´ì¸ <a href="https://docs.python.org/ko/3.13/library/asyncio-protocol.html#transports">Transport</a> ê°ì²´ì— ë“±ë¡í•˜ëŠ” ì½œë°±ì„ í¬í•¨í•œ ì¸ìŠ¤í„´ìŠ¤ì´ë‹¤.</p>
<p>ì‰½ê²Œ ì„¤ëª…í•˜ë©´ <strong>ì´ë²¤íŠ¸ ë£¨í”„ê°€ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ê³ , Transportê°€ ì•½ì†ëœ Protocolì˜ í–‰ë™(ë©”ì„œë“œ)ë“¤ì„ ìˆ˜í–‰</strong>í•˜ë„ë¡ ë˜ì–´ ìˆëŠ” ê²ƒì´ë‹¤.</p>
<p>ì½”ë“œë¥¼ ë³´ë©´, ì´ë²¤íŠ¸ë£¨í”„ì˜ <code>create_server</code> ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê³ , <code>create_protocol</code>ë©”ì„œë“œë¥¼ ë“±ë¡í•œë‹¤. ì´í›„ <strong>TCP connectionì´ ìƒì„±ë˜ë©´ ì´ë²¤íŠ¸ë£¨í”„ê°€ create_protocolì„ í˜¸ì¶œ</strong>í•˜ì—¬ HTTP Protocol ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , ìš”ì²­ì‹œ protocolì˜ data_recievedê°€ í˜¸ì¶œí•œë‹¤. (<em>ì¼ë°˜ì ìœ¼ë¡œ í•˜ë‚˜ì˜ ìš”ì²­ì— í•˜ë‚˜ì˜ Protocolì´ ìƒì„±</em>ëœë‹¤)</p>
<p><code>curl http://localhost:8000/bada</code> ë¥¼ ì‹¤í–‰í–ˆì„ ë•Œì˜ íë¦„ì„ ë”°ë¼ê°€ë³´ì.</p>
<h2 class="heading" id="protocol">
  Protocol
  <a class="anchor" href="#protocol">#</a>
</h2>
<p><code>uvicorn/protocols/http/h11_impl.py</code></p>
<p>http ìš”ì²­ì˜ ê²½ìš°, ì˜µì…˜ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆëŠ”ë°(ê¸°ë³¸ì ìœ¼ë¡œëŠ” httptools) ì—¬ê¸°ì„œëŠ” h11_impl(ìˆœìˆ˜ íŒŒì´ì¬) ê¸°ì¤€ìœ¼ë¡œ ë³´ì.</p>
<p>HTTP ìš”ì²­ì‹œ, ë“±ë¡ëœ Protocol ì¸ìŠ¤í„´ìŠ¤ì˜ <code>data_received</code> ì½œë°±ì´ ìˆ˜í–‰ëœë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">class</span> <span style="color:#666;font-weight:bold;font-style:italic">H11Protocol</span>(asyncio.Protocol):
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">def</span> <span style="color:#666;font-weight:bold;font-style:italic">data_received</span>(<span style="font-weight:bold;font-style:italic">self</span>, data: <span style="font-weight:bold;font-style:italic">bytes</span>) -&gt; <span style="font-weight:bold;text-decoration:underline">None</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;font-style:italic">self</span>._unset_keepalive_if_required()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;font-style:italic">self</span>.conn.receive_data(data)
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;font-style:italic">self</span>.handle_events()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">def</span> <span style="color:#666;font-weight:bold;font-style:italic">handle_events</span>(<span style="font-weight:bold;font-style:italic">self</span>) -&gt; <span style="font-weight:bold;text-decoration:underline">None</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">while</span> <span style="font-weight:bold;text-decoration:underline">True</span>:
</span></span><span style="display:flex;"><span>            event = <span style="font-weight:bold;font-style:italic">self</span>.conn.next_event()
</span></span><span style="display:flex;"><span>            <span style="color:#888;font-style:italic"># HTTP ìš”ì²­ ì´ë²¤íŠ¸</span>
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold;text-decoration:underline">if</span> <span style="font-weight:bold;font-style:italic">isinstance</span>(event, h11.Request):
</span></span><span style="display:flex;"><span>                <span style="color:#888;font-style:italic"># scope ì´ˆê¸°í™”</span>
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold;font-style:italic">self</span>.scope = {
</span></span><span style="display:flex;"><span>                    <span style="color:#666;font-style:italic">&#34;type&#34;</span>: <span style="color:#666;font-style:italic">&#34;http&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#666;font-style:italic">&#34;asgi&#34;</span>: {<span style="color:#666;font-style:italic">&#34;version&#34;</span>: <span style="font-weight:bold;font-style:italic">self</span>.config.asgi_version, <span style="color:#666;font-style:italic">&#34;spec_version&#34;</span>: <span style="color:#666;font-style:italic">&#34;2.3&#34;</span>},
</span></span><span style="display:flex;"><span>                    <span style="color:#666;font-style:italic">&#34;http_version&#34;</span>: event.http_version.decode(<span style="color:#666;font-style:italic">&#34;ascii&#34;</span>),
</span></span><span style="display:flex;"><span>                    <span style="color:#666;font-style:italic">&#34;server&#34;</span>: <span style="font-weight:bold;font-style:italic">self</span>.server,
</span></span><span style="display:flex;"><span>                    <span style="color:#666;font-style:italic">&#34;client&#34;</span>: <span style="font-weight:bold;font-style:italic">self</span>.client,
</span></span><span style="display:flex;"><span>                    <span style="color:#666;font-style:italic">&#34;scheme&#34;</span>: <span style="font-weight:bold;font-style:italic">self</span>.scheme,
</span></span><span style="display:flex;"><span>                    <span style="color:#666;font-style:italic">&#34;method&#34;</span>: event.method.decode(<span style="color:#666;font-style:italic">&#34;ascii&#34;</span>),
</span></span><span style="display:flex;"><span>                    <span style="color:#666;font-style:italic">&#34;root_path&#34;</span>: <span style="font-weight:bold;font-style:italic">self</span>.root_path,
</span></span><span style="display:flex;"><span>                    <span style="color:#666;font-style:italic">&#34;path&#34;</span>: full_path,
</span></span><span style="display:flex;"><span>                    <span style="color:#666;font-style:italic">&#34;raw_path&#34;</span>: full_raw_path,
</span></span><span style="display:flex;"><span>                    <span style="color:#666;font-style:italic">&#34;query_string&#34;</span>: query_string,
</span></span><span style="display:flex;"><span>                    <span style="color:#666;font-style:italic">&#34;headers&#34;</span>: <span style="font-weight:bold;font-style:italic">self</span>.headers,
</span></span><span style="display:flex;"><span>                    <span style="color:#666;font-style:italic">&#34;state&#34;</span>: <span style="font-weight:bold;font-style:italic">self</span>.app_state.copy(),
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#888;font-style:italic"># WS upgrade</span>
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold;text-decoration:underline">if</span> <span style="font-weight:bold;font-style:italic">self</span>._should_upgrade():
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold;font-style:italic">self</span>.handle_websocket_upgrade(event)
</span></span><span style="display:flex;"><span>                    <span style="font-weight:bold;text-decoration:underline">return</span>
</span></span><span style="display:flex;"><span>                app = <span style="font-weight:bold;font-style:italic">self</span>.app
</span></span><span style="display:flex;"><span>                <span style="color:#888;font-style:italic"># Cycle ìƒì„±</span>
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold;font-style:italic">self</span>.cycle = RequestResponseCycle(
</span></span><span style="display:flex;"><span>                    scope=<span style="font-weight:bold;font-style:italic">self</span>.scope,
</span></span><span style="display:flex;"><span>                    conn=<span style="font-weight:bold;font-style:italic">self</span>.conn,
</span></span><span style="display:flex;"><span>                    transport=<span style="font-weight:bold;font-style:italic">self</span>.transport,
</span></span><span style="display:flex;"><span>                    flow=<span style="font-weight:bold;font-style:italic">self</span>.flow,
</span></span><span style="display:flex;"><span>                    logger=<span style="font-weight:bold;font-style:italic">self</span>.logger,
</span></span><span style="display:flex;"><span>                    access_logger=<span style="font-weight:bold;font-style:italic">self</span>.access_logger,
</span></span><span style="display:flex;"><span>                    access_log=<span style="font-weight:bold;font-style:italic">self</span>.access_log,
</span></span><span style="display:flex;"><span>                    default_headers=<span style="font-weight:bold;font-style:italic">self</span>.server_state.default_headers,
</span></span><span style="display:flex;"><span>                    message_event=asyncio.Event(),
</span></span><span style="display:flex;"><span>                    on_response=<span style="font-weight:bold;font-style:italic">self</span>.on_response_complete,
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                <span style="color:#888;font-style:italic"># event loopì— task ë“±ë¡</span>
</span></span><span style="display:flex;"><span>                task = <span style="font-weight:bold;font-style:italic">self</span>.loop.create_task(<span style="font-weight:bold;font-style:italic">self</span>.cycle.run_asgi(app))
</span></span><span style="display:flex;"><span>                task.add_done_callback(<span style="font-weight:bold;font-style:italic">self</span>.tasks.discard)
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold;font-style:italic">self</span>.tasks.add(task)
</span></span></code></pre></div><p>ì´ë²¤íŠ¸ ë£¨í”„ì— ì˜í•´ transportê°€  <code>H11Protocol</code> ê°ì²´ì˜ <code>data_received</code> ì½œë°±ì„ í˜¸ì¶œí•˜ê³ , ì´ëŠ” (uvicorn ê¸°ì¤€) <code>handle_events</code>ë¥¼ í˜¸ì¶œí•˜ì—¬ ASGI applicationì— ë„˜ê²¨ì¤„ ì¸ìë“¤ì„ ë§Œë“¤ì–´ì£¼ê³  cycleì—ì„œ applicationì„ ì‹¤í–‰í•˜ë„ë¡ taskë¡œ ë“±ë¡í•œë‹¤.</p>
<h3 class="heading" id="cycle-uvicorn">
  Cycle (uvicorn)
  <a class="anchor" href="#cycle-uvicorn">#</a>
</h3>
<p><code>uvicorn/protocols/http/h11_impl.py</code></p>
<p>cycleì€ uvicornì—ì„œ ASGI applicationì„ ì‹¤í–‰í•˜ê³  ì²˜ë¦¬í•˜ëŠ” ì£¼ì²´ì´ë‹¤. <code>run_asgi</code> ë©”ì„œë“œë¡œ ìš°ë¦¬ê°€ ë§Œë“  applicationì´ í˜¸ì¶œë  ê²ƒì´ë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">class</span> <span style="color:#666;font-weight:bold;font-style:italic">RequestResponseCycle</span>:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">async</span> <span style="font-weight:bold;text-decoration:underline">def</span> <span style="color:#666;font-weight:bold;font-style:italic">run_asgi</span>(<span style="font-weight:bold;font-style:italic">self</span>, app: ASGI3Application) -&gt; <span style="font-weight:bold;text-decoration:underline">None</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">try</span>:
</span></span><span style="display:flex;"><span>            result = <span style="font-weight:bold;text-decoration:underline">await</span> app(  
</span></span><span style="display:flex;"><span>                <span style="font-weight:bold;font-style:italic">self</span>.scope, <span style="font-weight:bold;font-style:italic">self</span>.receive, <span style="font-weight:bold;font-style:italic">self</span>.send
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">except</span> BaseException <span style="font-weight:bold;text-decoration:underline">as</span> exc:
</span></span><span style="display:flex;"><span>            ...
</span></span></code></pre></div><h2 class="heading" id="asgi-application-ì‹¤í–‰">
  ASGI Application ì‹¤í–‰
  <a class="anchor" href="#asgi-application-%ec%8b%a4%ed%96%89">#</a>
</h2>
<p>ì•„ê¹Œ ìƒì„±í•œ main.pyê°€ ì‹¤í–‰ë˜ì–´ 1ì´ˆê°„ ê¸°ë‹¤ë¦¬ê³  ì‘ë‹µì´ ì˜¨ë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>â¯ curl http://localhost:8000/bada
</span></span><span style="display:flex;"><span>hello bada
</span></span></code></pre></div><p>ì‘ë‹µ ì´í›„ ë‹¤ì‹œ ASGI ì„œë²„ê°€ ë¬´í•œë£¨í”„ë¥¼ ëŒë©° ì„œë²„ê°€ ìœ ì§€ëœë‹¤.</p>
<p>ë§Œì•½ ì¢…ë£Œí•˜ê²Œ ë˜ë©´ ASGI ì„œë²„ì—ì„œ cleanup ë™ì‘ì„ ìˆ˜í–‰í•˜ê³ , ë°˜í™˜í•˜ê²Œ ë  ê²ƒì´ë‹¤.</p>
<h2 class="heading" id="ì •ë¦¬">
  ì •ë¦¬
  <a class="anchor" href="#%ec%a0%95%eb%a6%ac">#</a>
</h2>
<ul>
<li>ASGI ì„œë²„ëŠ” ì‹œì‘ ì‹œ, asyncio ì´ë²¤íŠ¸ ë£¨í”„ì— Transport/Protocolì— ëŒ€í•œ ì •ë³´ã„¹ã„¹ ë“±ë¡í•œë‹¤.</li>
<li>HTTP ìš”ì²­/ì›¹ì†Œì¼“ë“±ì˜ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´, ì´ë²¤íŠ¸ ë£¨í”„ê°€ í•´ë‹¹ **Protocol ì¸ìŠ¤í„´ìŠ¤ì˜ ì½œë°±(data_received)**ì„ í˜¸ì¶œí•˜ê³ , Protocolì€ ì´ë¥¼ ì ì ˆíˆ íŒŒì‹±í•´ ì¸ìë¥¼ ë§Œë“¤ê³ , ASGI application(ì½”ë£¨í‹´)ì„ ì‹¤í–‰í•œë‹¤.</li>
<li>ASGI applicationì€ ì´ë²¤íŠ¸ ë£¨í”„ì— ì˜í•´ cooperativeí•˜ê²Œ ë™ì‘í•˜ë©°, <code>receive</code>ë¡œ ì…ë ¥ ì´ë²¤íŠ¸ë¥¼ ë°›ê³  <code>send</code>ë¡œ ì‘ë‹µ ì´ë²¤íŠ¸ë¥¼ ë‚´ë³´ë‚¸ë‹¤.</li>
</ul>
<p>ì²˜ìŒ ì •ë¦¬í•˜ë ¤ë˜ ê²ƒë³´ë‹¤ëŠ” ë‚´ìš©ì´ ë” ê¹Šì–´ì¡ŒëŠ”ë°, ì–¸ì  ê°€ ì´ë²¤íŠ¸ë£¨í”„ ê´€ë ¨í•œ ìŠ¤í™ë„ ì•Œì•„ë³´ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤ëŠ” ìƒê°ì´ ë“ ë‹¤.</p>
<p>ê·¸ëŸ¼ ëª¨ë‘ í™”ì´íŒ…ğŸ‘</p>

    
    
    <script src="https://giscus.app/client.js"
        data-repo="choieastsea/choieastsea.github.io"
        data-repo-id="R_kgDOMgbvhw"
        data-category=""
        data-category-id=""
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

    
    
  </div>

  

  

  
  

<div class="single-pagination">
    <hr />

    <div class="flexnowrap">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">â†</div>
                <div class="single-pagination-text">
                    <a href="/posts/14/">
                        ASGI - application
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  
  





    




  <footer>
    

    
    





    




    
    <p>Powered by
        <a href="https://gohugo.io/">Hugo</a>
        and
        <a href="https://github.com/tomfran/typo">tomfran/typo</a>
    </p>
    
    
    


  </footer>

  
</body>

<script src="/js/theme-switch.js"></script>
<script defer src="/js/copy-code.js"></script>
</html>
