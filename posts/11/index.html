<!DOCTYPE html>
<html lang="ko-kr"
  dir="ltr">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">








    






<link rel="icon" type="image/ico" href="https://choieastsea.github.io//favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://choieastsea.github.io//favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://choieastsea.github.io//favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="https://choieastsea.github.io//android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://choieastsea.github.io//apple-touch-icon.png">

<meta name="description" content=""/>



<title>
    
    SQLAlchemy (3) Session | choieastsea.github.io
    
</title>

<link rel="canonical" href="https://choieastsea.github.io/posts/11/"/>

<meta property="og:url" content="https://choieastsea.github.io/posts/11/">
  <meta property="og:site_name" content="choieastsea.github.io">
  <meta property="og:title" content="SQLAlchemy (3) Session">
  <meta property="og:description" content="session / íŠ¸ëœì­ì…˜ ê´€ë¦¬ / orm ëª¨ë¸ ì •ì˜ / ì¿¼ë¦¬ ì‹¤í–‰ ê´€ë ¨ ë©”ì„œë“œ/ engine, connection, session ë¹„êµ">
  <meta property="og:locale" content="ko_kr">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-04-15T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-04-15T00:00:00+00:00">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Sqlalchemy">
    <meta property="article:tag" content="Orm">
    <meta property="article:tag" content="Session">












<link rel="stylesheet" href="/assets/combined.min.0f4f5c64ee7100cff28e7c7366d922b5499829f72c91a53b9b17f236d85ad7e7.css" media="all">















    




</head>







<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="https://choieastsea.github.io/">choieastsea.github.io</a>
    </h1>

    <div class="flex">
        

        
        
      
        <p class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/about" >
                /about
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/posts" >
                /posts
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/tags" >
                /tags
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      




<div class="breadcrumbs"><a href="/">Home</a><span class="breadcrumbs-separator">/</span><a href="/posts/">Posts</a><span class="breadcrumbs-separator">/</span>
        <a href="/posts/11/">SQLAlchemy (3) Session</a></div>


<div >

  <div class="single-intro-container">

    

    <h1 class="single-title">SQLAlchemy (3) Session</h1>
    
    <p class="single-summary">session / íŠ¸ëœì­ì…˜ ê´€ë¦¬ / orm ëª¨ë¸ ì •ì˜ / ì¿¼ë¦¬ ì‹¤í–‰ ê´€ë ¨ ë©”ì„œë“œ/ engine, connection, session ë¹„êµ</p>
    

    

    <p class="single-readtime">
      
      
      
      <time datetime="2025-04-15T00:00:00&#43;00:00">April 15, 2025</time>
      

      
      &nbsp; Â· &nbsp;
      5 min read
      
    </p>

  </div>

  

  
  

  <div class="single-tags">
    
    <span>
      <a href="https://choieastsea.github.io/tags/python/">#Python</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/sqlalchemy/">#Sqlalchemy</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/orm/">#Orm</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/session/">#Session</a>
    </span>
    
    
  </div>

  
  

  

  
  <aside class="toc">
    <p><strong>Table of contents</strong></p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#íŠ¸ëœì­ì…˜-ê´€ë¦¬">íŠ¸ëœì­ì…˜ ê´€ë¦¬</a></li>
    <li><a href="#orm-ëª¨ë¸-ì •ì˜">ORM ëª¨ë¸ ì •ì˜</a></li>
    <li><a href="#ì¿¼ë¦¬-ì‹¤í–‰-ê´€ë ¨-ë©”ì„œë“œ">ì¿¼ë¦¬ ì‹¤í–‰ ê´€ë ¨ ë©”ì„œë“œ</a></li>
  </ul>
</nav>
  </aside>
  

  

  <div class="single-content">
    <p>ì§€ê¸ˆê¹Œì§€ sqlalchemyì˜ core layerì— ëŒ€í•´ ê³µë¶€í–ˆê³ , ì´ì œëŠ” orm layerì— ëŒ€í•´ ì•Œì•„ë³´ì. SQLAlchemyë¥¼ ì´ìš©í•œ applicationì„ ë‹¤ë£¨ê²Œ ëœë‹¤ë©´ ê°€ì¥ ë§ì´ ì ‘í•  ê²ƒì´ë‹¤.</p>
<h1 class="heading" id="session">
  Session
  <a class="anchor" href="#session">#</a>
</h1>
<p>sessionì€ sqlalchemy ê°ì²´ë¡œ, DBMSì™€ ORMìˆ˜ì¤€ìœ¼ë¡œ <strong>ìƒí˜¸ì‘ìš©í•˜ê³  íŠ¸ëœì­ì…˜ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ê°ì²´</strong>ì´ë‹¤.</p>
<p>ìƒì„±í•˜ëŠ” ë°©ë²•ìœ¼ë¡œëŠ” ëª‡ê°€ì§€ê°€ ìˆëŠ”ë°, ëª¨ë‘ <code>Engine</code> ì¸ìŠ¤í„´ìŠ¤ê°€ í•„ìš”í•˜ë‹¤.</p>
<ol>
<li>
<p><code>Session(Engine)</code></p>
</li>
<li>
<p><code>sessionmaker(bind=Engine)</code>ë¥¼ í†µí•œ ìƒì„±</p>
<p>sessionmakerëŠ” <!-- raw HTML omitted -->Sessionì„ ìƒì„±í•˜ê¸° ìœ„í•œ factory<!-- raw HTML omitted -->ì´ë©° í˜¸ì¶œì‹œ sessionì„ ìƒì„±í•´ì¤€ë‹¤. sessionmaker ì—­ì‹œ Engineì²˜ëŸ¼ ë³´í†µ DBë‹¹ í•˜ë‚˜ì”©ë§Œ ìˆìœ¼ë©´ ëœë‹¤.</p>
</li>
</ol>
<p>Session ê°ì²´ëŠ” context managerë¡œë„ ê°€ëŠ¥í•˜ë‹¤. <a href="https://github.com/zzzeek/sqlalchemy/blob/main/lib/sqlalchemy/orm/session.py#L1798-L1802">https://github.com/zzzeek/sqlalchemy/blob/main/lib/sqlalchemy/orm/session.py#L1798-L1802</a> í•´ë‹¹ ì½”ë“œë¥¼ ë³´ë©´, context managerê°€ ë‹«í ë•Œ(<code>__exit__</code>), connectionì´ ì¡´ì¬í•œë‹¤ë©´ ë°˜í™˜í•˜ëŠ” <code>close()</code>ë©”ì„œë“œê°€ ì‹¤í–‰ë¨ì„ ì•Œ ìˆ˜ ìˆë‹¤.</p>
<p>ì£¼ì˜í•  ì ìœ¼ë¡œëŠ” <em>Session ê°ì²´ê°€ ìƒì„±ë˜ì—ˆë‹¤ê³  í•´ì„œ connectionì´ í• ë‹¹ëœ ê²ƒì€ ì•„ë‹ˆë¼ëŠ” ì </em>ì´ë‹¤. ë‹¤ìŒ ì½”ë“œë¥¼ interactive modeë¡œ ì‹¤í–‰í•´ë³´ë©´ ì•Œ ìˆ˜ ìˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#888;font-style:italic"># test.py</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">from</span> <span style="color:#666;font-weight:bold;font-style:italic">sqlalchemy</span> <span style="font-weight:bold;text-decoration:underline">import</span> create_engine, text
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">from</span> <span style="color:#666;font-weight:bold;font-style:italic">sqlalchemy.orm</span> <span style="font-weight:bold;text-decoration:underline">import</span> sessionmaker
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>engine = create_engine(<span style="color:#666;font-style:italic">&#34;mysql+pymysql://root:password@localhost/test_db&#34;</span>, echo=<span style="font-weight:bold;text-decoration:underline">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sessionmaker = sessionmaker(bind=engine)
</span></span><span style="display:flex;"><span>session = sessionmaker()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">â¯</span> python -i test.py
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; (ì•„ë¬´ê²ƒë„ ì¶œë ¥ë˜ì§€ ì•ŠëŠ”ë‹¤)
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; session
</span></span><span style="display:flex;"><span>&lt;sqlalchemy.orm.session.Session <span style="font-weight:bold;font-style:italic">object</span> at 0x106472710&gt;
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; engine.pool.status()
</span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">&#39;Pool size: 5  Connections in pool: 0 Current Overflow: -5 Current Checked out connections: 0&#39;</span>
</span></span></code></pre></div><p><strong>sessionì´ ìƒê²¼ë‹¤ê³  í•´ì„œ connectionì„ ê°€ì ¸ì˜¤ì§€(<code>engine.connect()</code>) ì•Šì€ ê²ƒ</strong>ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. <em>ì‹¤ì œ DB ì‹¤í–‰ì‹œì— connection ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ê²ƒ</em>ì´ë‹¤.</p>
<h2 class="heading" id="íŠ¸ëœì­ì…˜-ê´€ë¦¬">
  íŠ¸ëœì­ì…˜ ê´€ë¦¬
  <a class="anchor" href="#%ed%8a%b8%eb%9e%9c%ec%9e%ad%ec%85%98-%ea%b4%80%eb%a6%ac">#</a>
</h2>
<ul>
<li><code>begin()</code> : engineê³¼ ë§ˆì°¬ê°€ì§€ë¡œ, <strong>application ë‚´ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë¨ì„ ëª…ì‹œí•˜ì§€ë§Œ, <code>BEGIN/START transaction;</code> ì¿¼ë¦¬ëŠ” ì•”ë¬µì ìœ¼ë¡œ ìˆ˜í–‰ëœë‹¤.</strong></li>
<li><code>close()</code> : ì„¸ì…˜ì„ ì¢…ë£Œí•˜ëŠ” ë©”ì„œë“œì´ë‹¤. context managerë¥¼ ì‚¬ìš©í–ˆë‹¤ë©´ ë‚˜ê°€ë©´ì„œ í˜¸ì¶œë˜ê³ , ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ ëª…ì‹œì ìœ¼ë¡œ ë‹«ì•„ì£¼ë„ë¡ í•œë‹¤. ê·¸ëŸ¬ë©´ í•´ë‹¹ íŠ¸ëœì­ì…˜ì„ ê¹”ë”í•˜ê²Œ ì •ë¦¬í•  ê²ƒì´ë‹¤.</li>
<li><code>commit()</code>  : ì»¤ë°‹ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•œë‹¤.</li>
<li><code>rollback()</code> : ë¡¤ë°± ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•œë‹¤.</li>
</ul>
<p>begin() ë©”ì„œë“œ ì—­ì‹œ, <code>contextmanager</code>ë¡œë„ í™œìš©ë  ìˆ˜ ìˆì–´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ì´ ì¡´ì¬í•œë‹¤. <a href="https://docs.sqlalchemy.org/en/20/orm/session_basics.html#framing-out-a-begin-commit-rollback-block">ì¶œì²˜</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#888;font-style:italic"># 1</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">with</span> Session(engine) <span style="font-weight:bold;text-decoration:underline">as</span> session:
</span></span><span style="display:flex;"><span>    session.begin()
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">try</span>:
</span></span><span style="display:flex;"><span>        session.add(some_object)
</span></span><span style="display:flex;"><span>        session.add(some_other_object)
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">except</span>:
</span></span><span style="display:flex;"><span>        session.rollback()
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">raise</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">else</span>:
</span></span><span style="display:flex;"><span>        session.commit()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"># 2</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">with</span> Session(engine) <span style="font-weight:bold;text-decoration:underline">as</span> session:
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">with</span> session.begin():
</span></span><span style="display:flex;"><span>        session.add(some_object)
</span></span><span style="display:flex;"><span>        session.add(some_other_object)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"># 3</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">with</span> Session(engine) <span style="font-weight:bold;text-decoration:underline">as</span> session, session.begin():
</span></span><span style="display:flex;"><span>    session.add(some_object)
</span></span><span style="display:flex;"><span>    session.add(some_other_object)
</span></span></code></pre></div><p>begin()ì‹œì—ëŠ” íŠ¸ëœì­ì…˜ì´ ì—´ë¦¬ë©°, <code>close()</code>ì‹œì— rollback()/commit()ì´ ì‹¤í–‰ëœë‹¤.</p>
<p><strong>begin() ì—­ì‹œ engineê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì¿¼ë¦¬ê°€ ë‚˜ê°(+connectionì„ ê°€ì ¸ì˜´)ì„ ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤!</strong></p>
<p>ì—­ìœ¼ë¡œ, <code>close()</code> ë©”ì„œë“œë„ connectionì´ í• ë‹¹ë˜ì§€ ì•Šì•˜ë‹¤ë©´ êµ³ì´ ì¿¼ë¦¬ê°€ ë‚˜ê°€ì§€ ì•Šì„ ê²ƒì´ë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="">â¯</span> python -i test.py
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; session.begin()
</span></span><span style="display:flex;"><span>&lt;sqlalchemy.orm.session.SessionTransaction <span style="font-weight:bold;font-style:italic">object</span> at 0x1046085f0&gt;
</span></span><span style="display:flex;"><span><span style="color:#888;font-style:italic"># transactionì„ ì—´ì—ˆë‹¤ê³  í•´ì„œ begin/start ì¿¼ë¦¬ê°€ ë‚˜ê°€ì§€ ì•ŠëŠ”ë‹¤</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; engine.pool.status()
</span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">&#39;Pool size: 5  Connections in pool: 0 Current Overflow: -5 Current Checked out connections: 0&#39;</span>
</span></span></code></pre></div><h2 class="heading" id="orm-ëª¨ë¸-ì •ì˜">
  ORM ëª¨ë¸ ì •ì˜
  <a class="anchor" href="#orm-%eb%aa%a8%eb%8d%b8-%ec%a0%95%ec%9d%98">#</a>
</h2>
<p>ì„¸ì…˜ ê°ì²´ë¡œ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ê°„ë‹¨í•œ ORM entityë¥¼ ì •ì˜í•´ë³´ì.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-mysql" data-lang="mysql"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">CREATE</span> <span style="font-weight:bold;text-decoration:underline">TABLE</span> <span style="color:#666;font-weight:bold;font-style:italic">item</span> (
</span></span><span style="display:flex;"><span>    id <span style="font-weight:bold;text-decoration:underline">INT</span> <span style="font-weight:bold;text-decoration:underline">AUTO_INCREMENT</span> <span style="font-weight:bold;text-decoration:underline">PRIMARY</span> <span style="font-weight:bold;text-decoration:underline">KEY</span>,
</span></span><span style="display:flex;"><span>    name <span style="font-weight:bold;text-decoration:underline">VARCHAR</span>(255) <span style="font-weight:bold;text-decoration:underline">NOT</span> <span style="color:#666;font-weight:bold;font-style:italic">NULL</span>,
</span></span><span style="display:flex;"><span>    price <span style="font-weight:bold;text-decoration:underline">FLOAT</span> <span style="font-weight:bold;text-decoration:underline">NOT</span> <span style="color:#666;font-weight:bold;font-style:italic">NULL</span>,
</span></span><span style="display:flex;"><span>    created_at <span style="font-weight:bold;text-decoration:underline">DATETIME</span> <span style="font-weight:bold;text-decoration:underline">NOT</span> <span style="color:#666;font-weight:bold;font-style:italic">NULL</span> <span style="font-weight:bold;text-decoration:underline">DEFAULT</span> <span style="font-weight:bold;text-decoration:underline">CURRENT_TIMESTAMP</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">from</span> <span style="color:#666;font-weight:bold;font-style:italic">sqlalchemy</span> <span style="font-weight:bold;text-decoration:underline">import</span> Column, Integer, String, Float, DateTime, func
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">from</span> <span style="color:#666;font-weight:bold;font-style:italic">sqlalchemy.ext.declarative</span> <span style="font-weight:bold;text-decoration:underline">import</span> declarative_base
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Base = declarative_base()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">class</span> <span style="color:#666;font-weight:bold;font-style:italic">Item</span>(Base):
</span></span><span style="display:flex;"><span>    __tablename__ = <span style="color:#666;font-style:italic">&#34;item&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;font-style:italic">id</span> = Column(Integer, primary_key=<span style="font-weight:bold;text-decoration:underline">True</span>, autoincrement=<span style="font-weight:bold;text-decoration:underline">True</span>)
</span></span><span style="display:flex;"><span>    name = Column(String(255), nullable=<span style="font-weight:bold;text-decoration:underline">False</span>)
</span></span><span style="display:flex;"><span>    price = Column(Float, nullable=<span style="font-weight:bold;text-decoration:underline">False</span>)
</span></span><span style="display:flex;"><span>    created_at = Column(DateTime, nullable=<span style="font-weight:bold;text-decoration:underline">False</span>, server_default=func.now())
</span></span></code></pre></div><p><a href="https://docs.sqlalchemy.org/en/20/orm/mapping_styles.html#orm-declarative-mapping">Declaritve definition</a>ìœ¼ë¡œ ëª¨ë¸ì„ ì •ì˜í•˜ì˜€ë‹¤. ëª¨ë¸ì„ ì •ì˜í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œëŠ” ê¸°íšŒê°€ ë˜ë©´ ë‹¤ë£¨ë„ë¡ í•˜ê² ë‹¤ğŸ˜…</p>
<h2 class="heading" id="ì¿¼ë¦¬-ì‹¤í–‰-ê´€ë ¨-ë©”ì„œë“œ">
  ì¿¼ë¦¬ ì‹¤í–‰ ê´€ë ¨ ë©”ì„œë“œ
  <a class="anchor" href="#%ec%bf%bc%eb%a6%ac-%ec%8b%a4%ed%96%89-%ea%b4%80%eb%a0%a8-%eb%a9%94%ec%84%9c%eb%93%9c">#</a>
</h2>
<ul>
<li>
<p><code>add(obj)</code></p>
<p>ORM ê°ì²´ëŠ” ì„¸ì…˜ì„ í†µí•´ ì¶”ê°€/ë³€ê²½/ì‚­ì œ ë˜ì–´ì•¼í•˜ëŠ”ë°, ì„¸ì…˜ì— ë“±ë¡ë˜ì§€ ì•Šì€ ê°ì²´ëŠ” add ë©”ì„œë“œë¥¼ í†µí•´ ì¶”ê°€ë  ìˆ˜ ìˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="">â¯</span> python -i test.py
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; session._new
</span></span><span style="display:flex;"><span>{}
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; item1 = Item(name=<span style="color:#666;font-style:italic">&#39;item1&#39;</span>, price=10000)
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; session.add(item1)
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; session._new
</span></span><span style="display:flex;"><span>{&lt;sqlalchemy.orm.state.InstanceState <span style="font-weight:bold;font-style:italic">object</span> at 0x102679970&gt;: &lt;__main__.Item <span style="font-weight:bold;font-style:italic">object</span> at 0x104a5b790&gt;}
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; session.add(item1) <span style="color:#888;font-style:italic"># í•œë²ˆ ë” ì¶”ê°€</span>
</span></span><span style="display:flex;"><span>{&lt;sqlalchemy.orm.state.InstanceState <span style="font-weight:bold;font-style:italic">object</span> at 0x102679970&gt;: &lt;__main__.Item <span style="font-weight:bold;font-style:italic">object</span> at 0x104a5b790&gt;} <span style="color:#888;font-style:italic"># ê°™ì€ ê²°ê³¼</span>
</span></span></code></pre></div><p>ìœ„ì˜ ì˜ˆì œì—ì„œ, item1ì€ ìƒì„±ë˜ì—ˆì§€ë§Œ sessionê³¼ ì—°ê²°ë˜ì§€ ì•Šì•„ addë¡œ ì¶”ê°€í•´ì£¼ì—ˆë‹¤. Sessionì€ í•´ë‹¹ íŠ¸ëœì­ì…˜ ë‚´ì— ì¶”ê°€ë  ê²ƒ(new), ë³€ê²½ë  ê²ƒ(dirty), ì‚­ì œë  ê°ì²´(deleted)ë“¤ì„ <code>IdentitySet</code>ë¼ê³  í•˜ëŠ” set ìë£Œí˜• ë‚´ì—ì„œ ê´€ë¦¬ëœë‹¤. ë”°ë¼ì„œ <code>id(obj)</code>ê°€ ê°™ì€ ê°ì²´ë¥¼ ê³„ì† addí•˜ë”ë¼ë„ sessionì—ëŠ” ì¶”ê°€ë˜ì§€ ì•ŠìŒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
</li>
<li>
<p><code>flush()</code></p>
<p>DBMSì— sessionì„ ì˜ì†í™”í•˜ëŠ” ë©”ì„œë“œì´ë‹¤. <em>commitì€ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.</em></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>&gt;&gt;&gt; session.flush()
</span></span><span style="display:flex;"><span>2025-04-15 22:37:01,312 INFO sqlalchemy.engine.Engine SELECT DATABASE()
</span></span><span style="display:flex;"><span>2025-04-15 22:37:01,312 INFO sqlalchemy.engine.Engine [raw sql] {}
</span></span><span style="display:flex;"><span>2025-04-15 22:37:01,314 INFO sqlalchemy.engine.Engine SELECT @@sql_mode
</span></span><span style="display:flex;"><span>2025-04-15 22:37:01,314 INFO sqlalchemy.engine.Engine [raw sql] {}
</span></span><span style="display:flex;"><span>2025-04-15 22:37:01,315 INFO sqlalchemy.engine.Engine SELECT @@lower_case_table_names
</span></span><span style="display:flex;"><span>2025-04-15 22:37:01,315 INFO sqlalchemy.engine.Engine [raw sql] {}
</span></span><span style="display:flex;"><span>2025-04-15 22:37:01,316 INFO sqlalchemy.engine.Engine BEGIN (implicit)
</span></span><span style="display:flex;"><span>2025-04-15 22:37:01,321 INFO sqlalchemy.engine.Engine INSERT INTO item (name, price) VALUES (%(name)s, %(price)s)
</span></span><span style="display:flex;"><span>2025-04-15 22:37:01,321 INFO sqlalchemy.engine.Engine [generated <span style="font-weight:bold">in</span> 0.00017s] {<span style="color:#666;font-style:italic">&#39;name&#39;</span>: <span style="color:#666;font-style:italic">&#39;item1&#39;</span>, <span style="color:#666;font-style:italic">&#39;price&#39;</span>: 10000}
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; engine.pool.status()
</span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">&#39;Pool size: 5  Connections in pool: 0 Current Overflow: -4 Current Checked out connections: 1&#39;</span>
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; session.in_transaction()
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">True</span>
</span></span></code></pre></div><p>ì‹¤í–‰ë˜ëŠ” queryëŠ” sessionì˜ ìƒíƒœì— ë”°ë¼ flush ì‹œì ì— ê²°ì •ë˜ì–´ ìˆ˜í–‰ëœë‹¤. session ì´ˆê¸°í™” ì‹œì ì´ ì•„ë‹Œ <strong>ì‹¤ì œ connectionì´ í•„ìš”í•œ ì‹œê¸°ì— lazy í•˜ê²Œ ê°€ì ¸ì˜´</strong>ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<p>Sessionì€ identity map ì´ë¼ëŠ” ê³³ì— ë°ì´í„°ë¥¼ ì €ì¥(in memory)í•´ë†“ê³  <code>flush()</code> ì‹œì ì— ë³€ê²½ ì‘ì—…ë“¤ì„ í•œë²ˆì— ë°˜ì˜í•˜ëŠ”ë°, ì´ëŸ¬í•œ ì¸¡ë©´ì—ì„œ  <code>unit of work</code> íŒ¨í„´ì„ ë‚˜íƒ€ë‚¸ë‹¤.</p>
</li>
<li>
<p><code>refresh(obj)</code></p>
<p>í•´ë‹¹ ê°ì²´ë¥¼ ìµœì‹ í™”í•˜ëŠ”ë° ì‚¬ìš©í•œë‹¤. ì™¸ë¶€ ìš”ì¸ìœ¼ë¡œ ì¸í•´ ê°ì²´ê°€ ë³€ê²½ëì„ ìˆ˜ë„ ìˆëŠ”ë°, ì´ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤. select ì¿¼ë¦¬ê°€ ë‚˜ê°„ë‹¤.</p>
</li>
<li>
<p><code>delete(obj)</code></p>
</li>
</ul>
<p>â€‹	í•´ë‹¹ ORM ê°ì²´ë¥¼ ì§€ìš´ë‹¤. <code>session._deleted</code> identity setì— ì¶”ê°€ë˜ê³  flushì‹œì— delete ì¿¼ë¦¬ê°€ ë‚˜ê°ˆ ê²ƒì´ë‹¤.</p>
<ul>
<li>
<p><code>execute(statement)</code></p>
<p>ì¿¼ë¦¬ë¥¼ ë§Œë“¤ê³  ì´ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>&gt;&gt;&gt; stmt = select(Item).where(Item.name==<span style="color:#666;font-style:italic">&#39;item1&#39;</span>)
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; session.execute(stmt)
</span></span><span style="display:flex;"><span>2025-04-15 22:50:05,789 INFO sqlalchemy.engine.Engine SELECT DATABASE()
</span></span><span style="display:flex;"><span>2025-04-15 22:50:05,789 INFO sqlalchemy.engine.Engine [raw sql] {}
</span></span><span style="display:flex;"><span>2025-04-15 22:50:05,790 INFO sqlalchemy.engine.Engine SELECT @@sql_mode
</span></span><span style="display:flex;"><span>2025-04-15 22:50:05,790 INFO sqlalchemy.engine.Engine [raw sql] {}
</span></span><span style="display:flex;"><span>2025-04-15 22:50:05,791 INFO sqlalchemy.engine.Engine SELECT @@lower_case_table_names
</span></span><span style="display:flex;"><span>2025-04-15 22:50:05,791 INFO sqlalchemy.engine.Engine [raw sql] {}
</span></span><span style="display:flex;"><span>2025-04-15 22:50:05,792 INFO sqlalchemy.engine.Engine BEGIN (implicit)
</span></span><span style="display:flex;"><span>2025-04-15 22:50:05,793 INFO sqlalchemy.engine.Engine SELECT item.id, item.name, item.price, item.created_at 
</span></span><span style="display:flex;"><span>FROM item 
</span></span><span style="display:flex;"><span>WHERE item.name = %(name_1)s
</span></span><span style="display:flex;"><span>2025-04-15 22:50:05,793 INFO sqlalchemy.engine.Engine [generated <span style="font-weight:bold">in</span> 0.00010s] {<span style="color:#666;font-style:italic">&#39;name_1&#39;</span>: <span style="color:#666;font-style:italic">&#39;item1&#39;</span>}
</span></span><span style="display:flex;"><span>&lt;sqlalchemy.engine.result.ChunkedIteratorResult <span style="font-weight:bold;font-style:italic">object</span> at 0x105c83c50&gt;
</span></span></code></pre></div><p>í•´ë‹¹ ì‹œì ì— ì¿¼ë¦¬ê°€ ìˆ˜í–‰ë˜ì§€ë§Œ <strong>ê²°ê³¼ê°€ ë©”ëª¨ë¦¬ì— ì ì¬ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤</strong>ê³  í•œë‹¤. ë”°ë¼ì„œ <code>all(), first(), one(), one_or_none()</code> ë“± ë©”ì„œë“œë¥¼ í†µí•´ ì´ë¥¼ application memoryë¡œ ê°€ì ¸ì˜¨ë‹¤. ì´ë ‡ê²Œ ë‚˜ëˆ ì§„ ì´ìœ ëŠ” executeëŠ” <strong>ì‚¬ì‹¤ Python DB APIì—ì„œ ì¿¼ë¦¬ë¥¼ í˜¸ì¶œí•˜ê³ (execute), ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ë¡œ ê°€ì ¸ì˜¤ëŠ”(fetch) ì‹œì ì´ ë‚˜ë‰˜ì–´ì ¸ìˆê¸° ë•Œë¬¸</strong>ì´ë‹¤. <a href="https://choieastsea.github.io/posts/8/#cursor">ì°¸ê³ </a></p>
</li>
<li>
<p><code>scalars/scalar(statement)</code></p>
<p>ì—­ì‹œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê³ , <code>ScalarResult</code> íƒ€ì…ì„ ë°˜í™˜í•œë‹¤.</p>
</li>
</ul>
<p>ORM ê°ì²´ë“¤ì€ ì„¸ì…˜ì— ì˜í•´ DBMSë¡œ ì˜ì†í™”ë  ìˆ˜ ìˆëŠ”ë°, ì´ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ stateê°€ ì¡´ì¬í•œë‹¤. <a href="https://docs.sqlalchemy.org/en/20/orm/session_state_management.html">ê³µì‹ ë¬¸ì„œ</a>ë¥¼ ì°¸ê³ í•˜ì—¬ ê°„ë‹¨í•œ ì»¨ì…‰ì„ ì´í•´í•˜ë©´ ì¢‹ì„ ê²ƒì´ë‹¤.</p>
<h1 class="heading" id="engine--connection--session">
  engine â†”ï¸ connection â†”ï¸ session
  <a class="anchor" href="#engine--connection--session">#</a>
</h1>
<p>ì´ì œ, engine, connection, sessionì— ëŒ€í•´ ì•Œì•„ë´¤ëŠ”ë°, ì°¨ì´ì ì„ ì •ë¦¬í•´ë³´ì.</p>
<p>engineì€ connectionë“¤ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ <strong>connection poolê³¼ DBMS ë§ˆë‹¤ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ Dialectë¥¼ í¬í•¨í•œ ê°ì²´</strong>ì´ë‹¤.</p>
<p>connectionì€ <a href="https://peps.python.org/pep-0249/#connection-objects">DB APIì˜ connection</a>ì„ ë˜í•‘í•œ ê°ì²´ì´ë‹¤. <strong>DBMSì™€ applicationê°„ì˜ TCP connection</strong>ë¥¼ í¬í•¨í•œë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.</p>
<p>sessionì€ <strong>í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì„ ìˆ˜í–‰í•˜ê³  ORM ê°ì²´ì™€ ë§¤í•‘ê³¼ ì˜ì†í™”ë¥¼ ìˆ˜í–‰</strong>í•˜ê¸° ìœ„í•œ ê°ì²´ì´ë‹¤.</p>
<p>ì´ ì •ë„ë¡œ SQLAlchemyì˜ ì»¨ì…‰ ì •ë„ëŠ” ì•Œì•„ë³¸ ê²ƒ ê°™ë‹¤. ê°œì¸ì ìœ¼ë¡œëŠ” engine, connection, sessionì˜ ê°œë…ê³¼ DBAPIì™€ì˜ ê´€ê³„ë¥¼ ëª…í™•í•˜ê²Œ ì´í•´í•˜ê³ , ì•Œì¼€ë¯¸ë¥¼ í™œìš©í•œë‹¤ë©´ ë”ìš± íš¨ìœ¨ì ì´ê³  ìƒì‚°ì ì¸ ì½”ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆì„ ê²ƒì´ë¼ê³  ìƒê°í•œë‹¤.</p>
<p>í™”ì´íŒ… ğŸ˜</p>

    
    
    <script src="https://giscus.app/client.js"
        data-repo="choieastsea/choieastsea.github.io"
        data-repo-id="R_kgDOMgbvhw"
        data-category=""
        data-category-id=""
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

    
    
  </div>

  

  

  
  

<div class="single-pagination">
    <hr />

    <div class="flexnowrap">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">â†</div>
                <div class="single-pagination-text">
                    <a href="/posts/10/">
                        SQLAlchemy (2) Engine
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
            <div class="single-pagination-container-next">
                <div class="single-pagination-text">
                    <a href="/posts/12/">
                        WAL(Write Ahead Log), ì“°ê¸° ì „ ë¡œê·¸
                    </a>
                </div>
                <div class="single-pagination-text">â†’</div>
            </div>
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  
  





    




  <footer>
    

    
    





    




    
    <p>Powered by
        <a href="https://gohugo.io/">Hugo</a>
        and
        <a href="https://github.com/tomfran/typo">tomfran/typo</a>
    </p>
    
    
    


  </footer>

  
</body>

<script src="/js/theme-switch.js"></script>
<script defer src="/js/copy-code.js"></script>
</html>
