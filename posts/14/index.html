<!DOCTYPE html>
<html lang="ko-kr"
  dir="ltr">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">








    






<link rel="icon" type="image/ico" href="https://choieastsea.github.io//favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://choieastsea.github.io//favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://choieastsea.github.io//favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="https://choieastsea.github.io//android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://choieastsea.github.io//apple-touch-icon.png">

<meta name="description" content=""/>



<title>
    
    ASGI - application | choieastsea.github.io
    
</title>

<link rel="canonical" href="https://choieastsea.github.io/posts/14/"/>

<meta property="og:url" content="https://choieastsea.github.io/posts/14/">
  <meta property="og:site_name" content="choieastsea.github.io">
  <meta property="og:title" content="ASGI - application">
  <meta property="og:description" content="개요 / Event / ASGI application / 정리">
  <meta property="og:locale" content="ko_kr">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-28T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-09-28T00:00:00+00:00">
    <meta property="article:tag" content="Web Server">
    <meta property="article:tag" content="Server">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Wsgi">
    <meta property="article:tag" content="Asgi">
    <meta property="article:tag" content="Fastapi">












<link rel="stylesheet" href="/assets/combined.min.0f4f5c64ee7100cff28e7c7366d922b5499829f72c91a53b9b17f236d85ad7e7.css" media="all">















    




</head>







<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="https://choieastsea.github.io/">choieastsea.github.io</a>
    </h1>

    <div class="flex">
        

        
        
      
        <p class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/about" >
                /about
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/posts" >
                /posts
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/tags" >
                /tags
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      




<div class="breadcrumbs"><a href="/">Home</a><span class="breadcrumbs-separator">/</span><a href="/posts/">Posts</a><span class="breadcrumbs-separator">/</span>
        <a href="/posts/14/">ASGI - application</a></div>


<div >

  <div class="single-intro-container">

    

    <h1 class="single-title">ASGI - application</h1>
    
    <p class="single-summary">개요 / Event / ASGI application / 정리</p>
    

    

    <p class="single-readtime">
      
      
      
      <time datetime="2025-09-28T00:00:00&#43;00:00">September 28, 2025</time>
      

      
      &nbsp; · &nbsp;
      4 min read
      
    </p>

  </div>

  

  
  

  <div class="single-tags">
    
    <span>
      <a href="https://choieastsea.github.io/tags/web-server/">#Web Server</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/server/">#Server</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/python/">#Python</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/wsgi/">#Wsgi</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/asgi/">#Asgi</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/fastapi/">#Fastapi</a>
    </span>
    
    
    <span>
      <a href="https://choieastsea.github.io/tags/starlette/">#Starlette</a>
    </span>
    
    
  </div>

  
  

  

  
  <aside class="toc">
    <p><strong>Table of contents</strong></p>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#개요">개요</a></li>
    <li><a href="#event">Event</a></li>
    <li><a href="#asgi-application">ASGI application</a>
      <ul>
        <li><a href="#lifespan">lifespan</a></li>
        <li><a href="#wsgi와의-차이점">WSGI와의 차이점</a></li>
        <li><a href="#fastapi--starlette">fastapi / starlette</a></li>
      </ul>
    </li>
    <li><a href="#정리">정리</a>
      <ul>
        <li><a href="#참고">참고</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </aside>
  

  

  <div class="single-content">
    <p>이전에 WSGI application, server, 그리고 middleware에 대한 스펙을 정의한 Proposal(PEP3333)에 대해 다뤘다.</p>
<p><a href="https://choieastsea.github.io/posts/4">이전 글</a>을 정리하면, python을 웹 서비스로 만들기 위해서는 WSGI를 준수하는 application(ex. django, flask app)와 이를 서빙할 WSGI server(gunicorn, uwsgi)를 선택해야한다고 했다.</p>
<p>이번 글에는 WSGI를 개선하여 다양한 통신 방법에 대응 가능한 스펙인 <code>ASGI</code>에 대해 알아보도록 한다.</p>
<h2 class="heading" id="개요">
  개요
  <a class="anchor" href="#%ea%b0%9c%ec%9a%94">#</a>
</h2>
<p>ASGI(Asynchronous Server Gateway Interface)는 <code>WSGI</code>의 <strong>한계를 극복하여 비동기 메커니즘을 지원하기 위해 고안된 표준 인터페이스</strong>이다. <code>PEP</code>에 채택되진 않았지만 <strong>사실상(de facto) 비동기 웹 표준</strong>으로 채택되어 사용된다.</p>
<p>역시 app과 server로 구성된다.</p>
<h2 class="heading" id="event">
  Event
  <a class="anchor" href="#event">#</a>
</h2>
<p>우선, ASGI의 <code>event</code>라는 개념을 알고 가면 좋을 것 같다.</p>
<p>ASGI는 application이 수신하고 작업, 응답까지의 과정을 각각의 event로 표현한다. event는 dictionary로 제공되며 &ldquo;type&quot;이라는 키(ex. <code>http.request</code>, <code>http.disconnect</code>)를 포함한다.</p>
<h2 class="heading" id="asgi-application">
  ASGI application
  <a class="anchor" href="#asgi-application">#</a>
</h2>
<p>ASGI app은 다음의 스펙을 준수해야 한다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">async</span> <span style="font-weight:bold;text-decoration:underline">def</span> <span style="color:#666;font-weight:bold;font-style:italic">application</span>(scope, receive, send):
</span></span></code></pre></div><p>위 application 함수는 ASGI server 구현체에 의해 호출될 것이다. 주요 파라미터들은 다음과 같다.</p>
<ul>
<li>
<p><code>scope</code>
연결(connection) 정보를 담고 있는 dictionary이다. key로는 &ldquo;type&rdquo; (value: &ldquo;http&rdquo;, &ldquo;websocket&rdquo;, &ldquo;lifespan&rdquo;), &ldquo;method&rdquo;, &ldquo;path&rdquo;, &ldquo;headers&rdquo; 등이 있다.</p>
<p>connection은 프로토콜에 따라 다른데, <em>HTTP의 경우 하나의 요청, ws의 경우 한 websocket connection을 의미</em>한다. scope는 WSGI의 environ처럼 request context의 일부를 담고 있다.</p>
</li>
<li>
<p><code>receive</code>
서버로부터 이벤트를 받아 새로운 event dictionary를 반환하는 awaitable 함수라고 한다. 서버에서 전달해주는 <em>이벤트에 대한 정보를 가져올 수 있는 코루틴</em>이라고 보면 된다.</p>
</li>
<li>
<p><code>send</code>
단일 event dictionary를 인자로 받는 awaitable 함수이고, <em>send 완료 혹은 connection 종료 시점에 return</em> None 한다.</p>
</li>
</ul>
<p>간단하게 정리하면, 이벤트 발생시 receive를 통해 server to app으로 내용을 받아올 수 있고, send를 통해 app to server로 이벤트를 전달한다. 연결에 대한 정적인 메타데이터는 scope에 담고 있다.</p>
<h3 class="heading" id="lifespan">
  lifespan
  <a class="anchor" href="#lifespan">#</a>
</h3>
<p>scope의 type 중에 <code>lifespan</code>이라는 게 올 수가 있다고 했는데, 이는 event loop의 lifecycle에 대한 이벤트이다. 이벤트 루프는 하나의 ASGI server process내에서 하나만 존재한다.</p>
<p><code>startup</code>과 <code>shutdown</code> 타입의 이벤트가 발생하여 해당 시점에 application context의 initialize나 cleanup을 수행할 수 있도록 지원한다.</p>
<p>또한, application context를 유지하고 싶은 경우, <code>scope[&quot;state&quot;]</code>라는 네임스페이스로 제공된다. 설정한 state는 이후 연결마다 shallow copy되어 전달되므로, application context로 활용할 객체(ex. db connection)를 넣는 식으로 활용 가능하다.</p>
<h3 class="heading" id="wsgi와의-차이점">
  WSGI와의 차이점
  <a class="anchor" href="#wsgi%ec%99%80%ec%9d%98-%ec%b0%a8%ec%9d%b4%ec%a0%90">#</a>
</h3>
<p>WSGI application의 인터페이스는 다음과 같았다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">def</span> <span style="color:#666;font-weight:bold;font-style:italic">app</span>(environ, start_response):
</span></span></code></pre></div><p>이는 요청-응답의 동기 구조로 되어있어, 비동기 이벤트에 대한 처리가 불가능한 구조이다. streaming, WebSocket과 같은 구조는 WSGI 스펙에서 정의된 것은 아니다.</p>
<p>ASGI는 WSGI에서의 <strong>단일 요청~응답을 connection(채널)과 여러 개의 event(메시지)로 세분화</strong>하였다고 볼 수 있다.</p>
<p>보통 ASGI server들은 WSGI application을 이벤트 루프에서 실행할 수 있는 wrapper middleware가 제공되어, <em>하나의 ASGI 서버는 ASGI, WSGI app 모두를 실행할 수 있다</em>.</p>
<h3 class="heading" id="fastapi--starlette">
  fastapi / starlette
  <a class="anchor" href="#fastapi--starlette">#</a>
</h3>
<p>대표적인 ASGI application인 <code>fastapi</code>는 어떻게 되어있나 살펴보자. 위에서 봤던 ASGI application spec을 class based로 구현하였고, 이는 <code>__call__</code> method를 보면 된다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#888;font-style:italic"># fastapi/applicatoins.py</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">class</span> <span style="color:#666;font-weight:bold;font-style:italic">FastAPI</span>(Starlette):
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">async</span> <span style="font-weight:bold;text-decoration:underline">def</span> __call__(<span style="font-weight:bold;font-style:italic">self</span>, scope: Scope, receive: Receive, send: Send) -&gt; <span style="font-weight:bold;text-decoration:underline">None</span>:
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">if</span> <span style="font-weight:bold;font-style:italic">self</span>.root_path:
</span></span><span style="display:flex;"><span>            scope[<span style="color:#666;font-style:italic">&#34;root_path&#34;</span>] = <span style="font-weight:bold;font-style:italic">self</span>.root_path
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">await</span> <span style="font-weight:bold;font-style:italic">super</span>().__call__(scope, receive, send)
</span></span></code></pre></div><p><a href="https://github.com/fastapi/fastapi/blob/master/fastapi/applications.py#L1079-L1082">출처</a></p>
<p>해당 클래스에서는 부모 클래스를 거의 그대로 호출한다. Starlette도 보자. (fastapi는 starlette + pydantic을 확장한 applicatoin framework라고 보면 좋을 것 같다)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#888;font-style:italic"># starlette/applications.py</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">class</span> <span style="color:#666;font-weight:bold;font-style:italic">Starlette</span>:
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">def</span> <span style="color:#666;font-weight:bold;font-style:italic">build_middleware_stack</span>(<span style="font-weight:bold;font-style:italic">self</span>) -&gt; ASGIApp:
</span></span><span style="display:flex;"><span>        debug = <span style="font-weight:bold;font-style:italic">self</span>.debug
</span></span><span style="display:flex;"><span>        error_handler = <span style="font-weight:bold;text-decoration:underline">None</span>
</span></span><span style="display:flex;"><span>        exception_handlers: <span style="font-weight:bold;font-style:italic">dict</span>[typing.Any, typing.Callable[[Request, Exception], Response]] = {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">for</span> key, value <span style="font-weight:bold">in</span> <span style="font-weight:bold;font-style:italic">self</span>.exception_handlers.items():
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold;text-decoration:underline">if</span> key <span style="font-weight:bold">in</span> (500, Exception):
</span></span><span style="display:flex;"><span>                error_handler = value
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold;text-decoration:underline">else</span>:
</span></span><span style="display:flex;"><span>                exception_handlers[key] = value
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        middleware = (
</span></span><span style="display:flex;"><span>            [Middleware(ServerErrorMiddleware, handler=error_handler, debug=debug)]
</span></span><span style="display:flex;"><span>            + <span style="font-weight:bold;font-style:italic">self</span>.user_middleware
</span></span><span style="display:flex;"><span>            + [Middleware(ExceptionMiddleware, handlers=exception_handlers, debug=debug)]
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        app = <span style="font-weight:bold;font-style:italic">self</span>.router
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">for</span> <span style="font-weight:bold;font-style:italic">cls</span>, args, kwargs <span style="font-weight:bold">in</span> <span style="font-weight:bold;font-style:italic">reversed</span>(middleware):
</span></span><span style="display:flex;"><span>            app = <span style="font-weight:bold;font-style:italic">cls</span>(app=app, *args, **kwargs)
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">return</span> app
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold;text-decoration:underline">async</span> <span style="font-weight:bold;text-decoration:underline">def</span> __call__(<span style="font-weight:bold;font-style:italic">self</span>, scope: Scope, receive: Receive, send: Send) -&gt; <span style="font-weight:bold;text-decoration:underline">None</span>:
</span></span><span style="display:flex;"><span>        scope[<span style="color:#666;font-style:italic">&#34;app&#34;</span>] = <span style="font-weight:bold;font-style:italic">self</span>
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">if</span> <span style="font-weight:bold;font-style:italic">self</span>.middleware_stack <span style="font-weight:bold">is</span> <span style="font-weight:bold;text-decoration:underline">None</span>:
</span></span><span style="display:flex;"><span>            <span style="font-weight:bold;font-style:italic">self</span>.middleware_stack = <span style="font-weight:bold;font-style:italic">self</span>.build_middleware_stack()
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold;text-decoration:underline">await</span> <span style="font-weight:bold;font-style:italic">self</span>.middleware_stack(scope, receive, send)
</span></span></code></pre></div><p><a href="https://github.com/Kludex/starlette/blob/main/starlette/applications.py#L109-L113">출처</a></p>
<p>middleware를 체이닝하여 application을 감싼 후 호출한다. fastapi에서도 흔히 사용하는 router의 개념도 starlette에서 온 것인데, ASGI에서 제안한 기능에 웹서버를 위한 고수준의 &ldquo;라우팅&rdquo; 클래스이다. ASGI 자체에는 routing에 대한 표준은 없다.</p>
<p>인자는 scope, receive, send로 ASGI application spec을 준수함을 확인할 수 있다.</p>
<h2 class="heading" id="정리">
  정리
  <a class="anchor" href="#%ec%a0%95%eb%a6%ac">#</a>
</h2>
<p>ASGI는 WSGI에서 제공하지 못하던 비동기 기능을 지원하기 위해 고안된 <strong>파이썬 비동기 웹 인터페이스의 사실상 표준</strong>이다.</p>
<p>ASGI application은 connection과 event에 대해 <code>scope</code>, <code>receive</code>, <code>send</code>를 파라미터로 전달하여 실행한다.</p>
<p>lifespan을 통해 이벤트 루프의 라이프사이클을 알 수 있고, application context variable을 위한 <code>state</code>라는 네임스페이스가 제공된다.</p>
<p>fastapi, starlette은 ASGI 스펙을 준수하고 추가 기능을 확장한 어플리케이션 프레임워크이다. ASGI server 스펙을 준수하는 uvicorn 등으로 실행이 가능하다.</p>
<p>다음에는 ASGI server에 대해서도 알아보도록 하자.</p>
<p>끝!!</p>
<h3 class="heading" id="참고">
  참고
  <a class="anchor" href="#%ec%b0%b8%ea%b3%a0">#</a>
</h3>
<p><a href="https://asgi.readthedocs.io/en/latest/index.html">https://asgi.readthedocs.io/en/latest/index.html</a></p>

    
    
    <script src="https://giscus.app/client.js"
        data-repo="choieastsea/choieastsea.github.io"
        data-repo-id="R_kgDOMgbvhw"
        data-category=""
        data-category-id=""
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

    
    
  </div>

  

  

  
  

<div class="single-pagination">
    <hr />

    <div class="flexnowrap">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">←</div>
                <div class="single-pagination-text">
                    <a href="/posts/13/">
                        백엔드 개발자 입장에서 정리한 LLM부터 AI Agent까지
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  
  





    




  <footer>
    

    
    





    




    
    <p>Powered by
        <a href="https://gohugo.io/">Hugo</a>
        and
        <a href="https://github.com/tomfran/typo">tomfran/typo</a>
    </p>
    
    
    


  </footer>

  
</body>

<script src="/js/theme-switch.js"></script>
<script defer src="/js/copy-code.js"></script>
</html>
